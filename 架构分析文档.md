# Gantto ç”˜ç‰¹å›¾åº”ç”¨ä»£ç æ¶æ„åˆ†æ

## æŠ€æœ¯æ ˆæ¦‚è§ˆ
- **å‰ç«¯æ¡†æ¶**: React 18 + TypeScript + Vite
- **åç«¯**: Tauri v2 (Rust)
- **UIç»„ä»¶åº“**: Radix UI
- **å›¾æ ‡åº“**: Lucide React
- **åŒ…ç®¡ç†å™¨**: pnpm

## æ ¸å¿ƒæ¶æ„æ¨¡å¼

### 1. åˆ†å±‚æ¶æ„è®¾è®¡
```
åº”ç”¨å±‚ (App.tsx)
â”œâ”€ è¡¨ç°å±‚ (Components)
â”œâ”€ ä¸šåŠ¡é€»è¾‘å±‚ (Hooks)
â”œâ”€ æ•°æ®è®¿é—®å±‚ (Types/Utils)
â””â”€ åŸºç¡€è®¾æ–½å±‚ (Styles/Assets)
```

### 2. ç»„ä»¶æ¶æ„

#### åº”ç”¨å…¥å£å±‚ `src/App.tsx:1`
- **åŠŸèƒ½**: åº”ç”¨æ ¹ç»„ä»¶ï¼Œå…¨å±€é”™è¯¯å¤„ç†
- **èŒè´£**: 
  - é¡¹ç›®æ“ä½œï¼ˆæ–°å»º/æ‰“å¼€/ä¿å­˜ï¼‰çš„æ¥å£å®šä¹‰
  - å…¨å±€é”™è¯¯è¾¹ç•Œç®¡ç†
  - ç”˜ç‰¹å›¾ç»„ä»¶çš„æ‡’åŠ è½½é¢„åŠ è½½

#### æ ¸å¿ƒç”˜ç‰¹å›¾ç»„ä»¶ `src/components/GanttChart.tsx:16`
- **åŠŸèƒ½**: ç”˜ç‰¹å›¾ä¸»ç»„ä»¶
- **çŠ¶æ€ç®¡ç†**: 
  - æ—¥æœŸèŒƒå›´æ§åˆ¶ (dateRangeStart/End)
  - æ—¶é—´é¢—ç²’åº¦æ§åˆ¶ (timeGranularity)
- **ç»„ä»¶ç»„åˆ**: é€šè¿‡ GanttStateManagerã€GanttEventCoordinatorã€GanttContainer å®ç°

#### ç”˜ç‰¹å›¾å­ç³»ç»Ÿæ¶æ„ `src/components/gantt/`

**çŠ¶æ€ç®¡ç†å±‚** `src/components/gantt/GanttStateManager.tsx:1` (**é‡æ„å: 144è¡Œ**)
- **åŠŸèƒ½**: è½»é‡çº§çŠ¶æ€åè°ƒä¸­å¿ƒï¼Œä¸“æ³¨äºHookç»„åˆå’Œæ•°æ®æµåè°ƒ
- **æ¨¡å—åŒ–è®¾è®¡**: 
  - çŠ¶æ€ç±»å‹å®šä¹‰: `state/GanttStateTypes.ts` (88è¡Œ)
  - å®¹å™¨ç®¡ç†: `state/GanttContainerManager.tsx` (47è¡Œ)
  - è®¡ç®—é€»è¾‘: `state/GanttStateCalculations.ts` (130è¡Œ)
- **é›†æˆHooks**: æ‹–æ‹½ã€ä»»åŠ¡ç®¡ç†ã€æ—¶é—´è½´ã€ç­›é€‰ã€UIçŠ¶æ€ã€äº‹ä»¶å¤„ç†
- **èŒè´£ä¼˜åŒ–**: ä»423è¡Œå·¨å‹ç»„ä»¶é‡æ„ä¸º144è¡Œåè°ƒå™¨ï¼Œæå‡66%ä»£ç ç®€æ´æ€§

**å®¹å™¨ç»„ä»¶å±‚** `src/components/gantt/GanttContainer.tsx:1`
- **åŠŸèƒ½**: å¸ƒå±€å®¹å™¨å’Œäº‹ä»¶åˆ†å‘
- **ç»„ä»¶ç»„åˆ**: GanttChartHeader + GanttChartBody + GanttMenuManager
- **æ¥å£å®šä¹‰**: ä»»åŠ¡CRUDæ“ä½œã€æ—¥æœŸèŒƒå›´æ§åˆ¶ã€æ‹–æ‹½çŠ¶æ€ç®¡ç†

**æ¸²æŸ“å±‚ç»„ä»¶**:
- `GanttChartHeader`: æ—¶é—´è½´å¤´éƒ¨æ¸²æŸ“
- `GanttChartBody`: ç”˜ç‰¹å›¾ä¸»ä½“æ¸²æŸ“
- `TaskBars`: ä»»åŠ¡æ¡å½¢å›¾æ¸²æŸ“
- `TaskTitleColumn`: ä»»åŠ¡æ ‡é¢˜åˆ—
- `TimelineHeader`: æ—¶é—´çº¿å¤´éƒ¨

### 3. ä¸šåŠ¡é€»è¾‘å±‚ (Hooksç³»ç»Ÿ) `src/hooks/index.ts:1`

#### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
- **ä»»åŠ¡ç®¡ç†**: `useTaskManager`, `useTaskCRUD`, `useTaskBatch`
- **æ‹–æ‹½äº¤äº’**: `useDragAndDrop`, `useHorizontalDrag`, `useVerticalDrag`
- **æ—¶é—´è½´**: `useTimeline`, `useGanttCalculations`
- **UIçŠ¶æ€**: `useGanttUI`, `useGanttUIState` (**é‡æ„å: 122è¡Œ**)
  - æ¨¡å—åŒ–UIçŠ¶æ€: `ui/useSelectionState.ts` (42è¡Œ), `ui/useMenuState.ts` (80è¡Œ)
  - æ¨¡æ€æ¡†ç®¡ç†: `ui/useModalState.ts` (148è¡Œ), `ui/useUIKeyboard.ts` (67è¡Œ)
- **äº‹ä»¶å¤„ç†**: `useGanttEvents`, `useGanttMouseEvents`, `useGanttKeyboard`

#### é«˜çº§åŠŸèƒ½æ¨¡å—
- **å±‚çº§ç®¡ç†**: `useTaskHierarchy`
- **é€‰æ‹©æœºåˆ¶**: `useTaskSelection`
- **ä¸Šä¸‹æ–‡èœå•**: `useContextMenus`, `useGanttContextMenu`
- **æ ‡ç­¾ç³»ç»Ÿ**: `useGlobalTags`

### 4. æ•°æ®æ¨¡å‹å±‚ `src/types/`

#### æ ¸å¿ƒæ•°æ®ç±»å‹ `src/types/task.ts:9`
```typescript
interface Task {
  // åŸºç¡€ä¿¡æ¯: id, title, description
  // æ—¶é—´ä¿¡æ¯: startDate, endDate
  // çŠ¶æ€ä¿¡æ¯: type, status, progress
  // å±‚çº§å…³ç³»: parentId, children, level
  // æ˜¾ç¤ºå±æ€§: color, tags, order
  // UIçŠ¶æ€: isExpanded
  // è®¡ç®—å±æ€§: x, width (å›¾è¡¨ç»˜åˆ¶)
}
```

#### ç±»å‹ä½“ç³»
- **ä»»åŠ¡ç±»å‹**: `task.ts` - ä»»åŠ¡æ•°æ®æ¨¡å‹
- **é¡¹ç›®ç±»å‹**: `project.ts` - é¡¹ç›®ç»“æ„å®šä¹‰
- **UIçŠ¶æ€**: `ui.ts` - æ‹–æ‹½ã€é€‰æ‹©ã€èœå•çŠ¶æ€
- **æ—¶é—´è½´**: `timeline.ts` - æ—¶é—´é…ç½®å’Œåº¦é‡
- **æ‹–æ‹½**: `drag.ts` - æ‹–æ‹½æ“ä½œçŠ¶æ€

### 5. å·¥å…·å‡½æ•°å±‚
- **ç”˜ç‰¹å›¾å·¥å…·**: `src/utils/ganttUtils.ts` - æ—¥æœŸè®¡ç®—ã€ä½ç½®è½¬æ¢
- **æ˜ å°„å·¥å…·**: `src/utils/taskProjectRowMapping.ts` - ä»»åŠ¡é¡¹ç›®è¡Œæ˜ å°„

### 6. æ ·å¼ç³»ç»Ÿ `src/styles/`
- **æ¨¡å—åŒ–CSS**: æŒ‰ç»„ä»¶å’ŒåŠŸèƒ½åˆ†ç±»
- **å“åº”å¼è®¾è®¡**: `responsive.css`
- **åŠ¨ç”»æ•ˆæœ**: `animations.css`

## æ¶æ„ç‰¹ç‚¹

### ä¼˜åŠ¿
1. **é«˜åº¦æ¨¡å—åŒ–**: åŠŸèƒ½æŒ‰é¢†åŸŸæ¸…æ™°åˆ†ç¦»
2. **Hooké©±åŠ¨**: ä¸šåŠ¡é€»è¾‘å®Œå…¨è§£è€¦
3. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹ä½“ç³»
4. **æ€§èƒ½ä¼˜åŒ–**: æ‡’åŠ è½½ã€èŠ‚æµç­‰ä¼˜åŒ–æªæ–½

### ç»„ä»¶é—´é€šä¿¡æ¨¡å¼
1. **çŠ¶æ€ç®¡ç†**: é€šè¿‡GanttStateManageré›†ä¸­ç®¡ç†
2. **äº‹ä»¶åè°ƒ**: é€šè¿‡GanttEventCoordinatorå¤„ç†
3. **æ•°æ®æµ**: å•å‘æ•°æ®æµï¼Œpropsä¸‹ä¼ ï¼Œäº‹ä»¶ä¸Šå†’æ³¡

### æ ¸å¿ƒåŠŸèƒ½å®ç°
1. **ä»»åŠ¡å±‚çº§**: æ”¯æŒçˆ¶å­å…³ç³»å’Œå±•å¼€/æŠ˜å 
2. **æ‹–æ‹½äº¤äº’**: æ°´å¹³æ—¶é—´è°ƒæ•´å’Œå‚ç›´æ’åº
3. **æ—¶é—´è½´**: å¤šç²’åº¦æ—¶é—´æ˜¾ç¤ºå’Œå¯¼èˆª
4. **è§†è§‰åé¦ˆ**: è¿›åº¦æ¡ã€çŠ¶æ€æŒ‡ç¤ºã€å½“å‰æ—¥æœŸçº¿

## ç»„ä»¶è¯¦ç»†è¯´æ˜

### æ ¸å¿ƒç»„ä»¶æ¨¡å—

#### 1. åº”ç”¨å±‚ç»„ä»¶
- **App.tsx**: åº”ç”¨æ ¹ç»„ä»¶ï¼Œç®¡ç†å…¨å±€çŠ¶æ€å’Œé”™è¯¯è¾¹ç•Œ
- **Header.tsx**: åº”ç”¨å¤´éƒ¨ï¼Œæä¾›é¡¹ç›®æ“ä½œæŒ‰é’®
- **Toolbar.tsx**: å·¥å…·æ ï¼ŒåŒ…å«è§†å›¾æ§åˆ¶å’Œç¼©æ”¾åŠŸèƒ½

#### 2. ç”˜ç‰¹å›¾æ ¸å¿ƒç»„ä»¶
- **GanttChart.tsx**: ä¸»ç”˜ç‰¹å›¾ç»„ä»¶ï¼Œç®¡ç†æ—¥æœŸèŒƒå›´å’Œæ—¶é—´é¢—ç²’åº¦
- **GanttChartLazy.tsx**: æ‡’åŠ è½½åŒ…è£…å™¨ï¼Œä¼˜åŒ–é¦–å±åŠ è½½æ€§èƒ½
- **LazyWrapper.tsx**: é€šç”¨æ‡’åŠ è½½ç»„ä»¶

#### 3. ç”˜ç‰¹å›¾å­ç³»ç»Ÿç»„ä»¶
- **GanttStateManager.tsx**: è½»é‡çº§çŠ¶æ€åè°ƒä¸­å¿ƒ (144è¡Œï¼Œé‡æ„å‰423è¡Œ)
  - **state/GanttStateTypes.ts**: çŠ¶æ€ç±»å‹å®šä¹‰æ¨¡å— (88è¡Œ)
  - **state/GanttContainerManager.tsx**: å®¹å™¨ç®¡ç†æ¨¡å— (47è¡Œ)  
  - **state/GanttStateCalculations.ts**: è®¡ç®—é€»è¾‘æ¨¡å— (130è¡Œ)
- **GanttEventCoordinator.tsx**: äº‹ä»¶åè°ƒå™¨ï¼Œå¤„ç†ç»„ä»¶é—´äº‹ä»¶é€šä¿¡
- **GanttContainer.tsx**: å¸ƒå±€å®¹å™¨ï¼Œç»„åˆå¤´éƒ¨å’Œä¸»ä½“ç»„ä»¶
- **GanttDataProvider.tsx**: æ•°æ®æä¾›è€…ï¼Œç®¡ç†æ•°æ®ä¸Šä¸‹æ–‡
- **GanttEventHandler.tsx**: äº‹ä»¶å¤„ç†å™¨ï¼Œç»Ÿä¸€äº‹ä»¶å¤„ç†é€»è¾‘

#### 4. æ¸²æŸ“å±‚ç»„ä»¶
- **GanttChartHeader.tsx**: ç”˜ç‰¹å›¾å¤´éƒ¨æ¸²æŸ“
- **GanttChartBody.tsx**: ç”˜ç‰¹å›¾ä¸»ä½“æ¸²æŸ“
- **TimelineHeader.tsx**: æ—¶é—´çº¿å¤´éƒ¨ç»„ä»¶
- **TaskBars.tsx**: ä»»åŠ¡æ¡å½¢å›¾æ¸²æŸ“ç»„ä»¶
- **TaskTitleColumn.tsx**: ä»»åŠ¡æ ‡é¢˜åˆ—ç»„ä»¶

#### 5. äº¤äº’ç»„ä»¶
- **TaskIcon.tsx**: ä»»åŠ¡å›¾æ ‡å’Œæ‹–æ‹½æ‰‹æŸ„
- **TaskIconSelector.tsx**: ä»»åŠ¡å›¾æ ‡é€‰æ‹©å™¨
- **ColorPicker.tsx**: é¢œè‰²é€‰æ‹©å™¨
- **DateRangePicker.tsx**: æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨
- **TimeGranularitySelector.tsx**: æ—¶é—´é¢—ç²’åº¦é€‰æ‹©å™¨

#### 6. èœå•å’Œç®¡ç†ç»„ä»¶
- **GanttContextMenu.tsx**: ç”˜ç‰¹å›¾ä¸Šä¸‹æ–‡èœå•
- **TaskContextMenu.tsx**: ä»»åŠ¡ä¸Šä¸‹æ–‡èœå•ï¼ˆç”˜ç‰¹å›¾åŒºåŸŸï¼‰
- **TaskTitleContextMenu.tsx**: ä»»åŠ¡æ ‡é¢˜å³é”®èœå•ï¼ˆæ–°å¢ 2025-07-20ï¼‰
- **GanttMenuManager.tsx**: èœå•ç®¡ç†å™¨
- **TagManager.tsx**: æ ‡ç­¾ç®¡ç†å™¨

#### 7. å±‚çº§æ§åˆ¶ç»„ä»¶
- **TaskHierarchyControls.tsx**: ä»»åŠ¡å±‚çº§æ§åˆ¶ç»„ä»¶
- **TaskTitleItem.tsx**: ä»»åŠ¡æ ‡é¢˜é¡¹ç»„ä»¶

#### 8. å·¥å…·ç»„ä»¶
- **ErrorBoundary.tsx**: é”™è¯¯è¾¹ç•Œç»„ä»¶
- **icons/index.ts**: å›¾æ ‡ç»„ä»¶é›†åˆ

### Hookç³»ç»Ÿè¯¦ç»†è¯´æ˜

#### 1. æ ¸å¿ƒçŠ¶æ€ç®¡ç†Hooks
- **useGanttState.tsx**: ç”˜ç‰¹å›¾ä¸»çŠ¶æ€ç®¡ç†
- **useGanttUIState.tsx**: UIçŠ¶æ€ç®¡ç† (122è¡Œï¼Œé‡æ„å‰345è¡Œ)
  - **ui/useSelectionState.ts**: ä»»åŠ¡é€‰æ‹©çŠ¶æ€ç®¡ç† (42è¡Œ)
  - **ui/useMenuState.ts**: èœå•çŠ¶æ€ç®¡ç† (80è¡Œ)
  - **ui/useModalState.ts**: æ¨¡æ€æ¡†çŠ¶æ€ç®¡ç† (148è¡Œ)
  - **ui/useUIKeyboard.ts**: UIé”®ç›˜å¤„ç† (67è¡Œ)
- **useTaskManager.tsx**: ä»»åŠ¡ç®¡ç†æ ¸å¿ƒé€»è¾‘

#### 2. ä»»åŠ¡æ“ä½œHooks
- **useTaskCRUD.tsx**: ä»»åŠ¡å¢åˆ æ”¹æŸ¥æ“ä½œ
- **useTaskBatch.tsx**: æ‰¹é‡ä»»åŠ¡æ“ä½œ
- **useTaskEditor.tsx**: ä»»åŠ¡ç¼–è¾‘åŠŸèƒ½
- **useTaskHierarchy.tsx**: ä»»åŠ¡å±‚çº§ç®¡ç†
- **useTaskAttributes.tsx**: ä»»åŠ¡å±æ€§ç®¡ç†
- **useTaskSelection.tsx**: ä»»åŠ¡é€‰æ‹©æœºåˆ¶
- **useTaskFilter.tsx**: ä»»åŠ¡ç­›é€‰åŠŸèƒ½

#### 3. æ‹–æ‹½ç³»ç»ŸHooks
- **useDragAndDrop.tsx**: æ‹–æ‹½ä¸»é€»è¾‘
- **useDragReducer.tsx**: æ‹–æ‹½çŠ¶æ€ç®¡ç†
- **useHorizontalDrag.tsx**: æ°´å¹³æ‹–æ‹½ï¼ˆæ—¶é—´è°ƒæ•´ï¼‰
- **useVerticalDrag.tsx**: å‚ç›´æ‹–æ‹½ï¼ˆæ’åºï¼‰
- **useThrottledMouseMove.tsx**: èŠ‚æµé¼ æ ‡ç§»åŠ¨äº‹ä»¶

#### 4. äº‹ä»¶å¤„ç†Hooks
- **useGanttEvents.tsx**: ç”˜ç‰¹å›¾äº‹ä»¶å¤„ç†
- **useGanttMouseEvents.tsx**: é¼ æ ‡äº‹ä»¶å¤„ç†
- **useGanttKeyboard.tsx**: é”®ç›˜äº‹ä»¶å¤„ç†
- **useGanttInteractions.tsx**: äº¤äº’é€»è¾‘ç®¡ç†
- **useGanttHandlers.tsx**: äº‹ä»¶å¤„ç†å™¨é›†åˆ

#### 5. UIæ§åˆ¶Hooks
- **useGanttUI.tsx**: UIæ§åˆ¶é€»è¾‘
- **useGanttCalculations.tsx**: ç”˜ç‰¹å›¾è®¡ç®—é€»è¾‘
- **useTimeline.tsx**: æ—¶é—´è½´ç®¡ç†
- **useTitleColumnResize.tsx**: æ ‡é¢˜åˆ—è°ƒæ•´å¤§å°

#### 6. èœå•ç³»ç»ŸHooks
- **useContextMenus.tsx**: ä¸Šä¸‹æ–‡èœå•ç®¡ç†
- **useGanttContextMenu.tsx**: ç”˜ç‰¹å›¾ä¸Šä¸‹æ–‡èœå•

#### 7. å…¨å±€åŠŸèƒ½Hooks
- **useGlobalTags.tsx**: å…¨å±€æ ‡ç­¾ç³»ç»Ÿ
- **useErrorHandler.tsx**: é”™è¯¯å¤„ç†
- **useThrottle.tsx**: èŠ‚æµå·¥å…·
- **useCache.tsx**: ç¼“å­˜å·¥å…·

### ç±»å‹ç³»ç»Ÿè¯´æ˜

#### 1. æ ¸å¿ƒæ•°æ®ç±»å‹
- **task.ts**: ä»»åŠ¡æ•°æ®æ¨¡å‹ï¼ŒåŒ…å«å®Œæ•´çš„ä»»åŠ¡ä¿¡æ¯ç»“æ„
- **project.ts**: é¡¹ç›®ç›¸å…³ç±»å‹å®šä¹‰
- **common.ts**: é€šç”¨ç±»å‹å®šä¹‰ï¼ˆTaskTypeã€TaskStatusç­‰ï¼‰

#### 2. UIçŠ¶æ€ç±»å‹
- **ui.ts**: UIçŠ¶æ€ç±»å‹ï¼ˆæ‹–æ‹½ã€é€‰æ‹©ã€èœå•çŠ¶æ€ï¼‰
- **drag.ts**: æ‹–æ‹½æ“ä½œç›¸å…³ç±»å‹
- **timeline.ts**: æ—¶é—´è½´é…ç½®å’Œåº¦é‡ç±»å‹

#### 3. ç”˜ç‰¹å›¾ç±»å‹
- **gantt.ts**: ç”˜ç‰¹å›¾ç‰¹å®šç±»å‹å®šä¹‰

### å·¥å…·å‡½æ•°è¯´æ˜

#### 1. ç”˜ç‰¹å›¾å·¥å…·å‡½æ•° `src/utils/ganttUtils.ts`
- æ—¥æœŸè®¡ç®—å’Œè½¬æ¢
- åƒç´ ä½ç½®è®¡ç®—
- ä»»åŠ¡å®šä½ç®—æ³•

#### 2. ä»»åŠ¡æ˜ å°„å·¥å…· `src/utils/taskProjectRowMapping.ts`
- ä»»åŠ¡ä¸é¡¹ç›®è¡Œçš„æ˜ å°„å…³ç³»
- å±‚çº§ç»“æ„å¤„ç†

### æ ·å¼ç³»ç»Ÿè¯´æ˜

#### 1. åŸºç¡€æ ·å¼
- **base.css**: åŸºç¡€æ ·å¼å®šä¹‰
- **index.css**: å…¨å±€æ ·å¼å…¥å£
- **layout.css**: å¸ƒå±€ç›¸å…³æ ·å¼
- **responsive.css**: å“åº”å¼è®¾è®¡
- **animations.css**: åŠ¨ç”»æ•ˆæœ

#### 2. ç»„ä»¶æ ·å¼
- **buttons.css**: æŒ‰é’®æ ·å¼
- **gantt.css**: ç”˜ç‰¹å›¾ä¸»è¦æ ·å¼
- **tasks.css**: ä»»åŠ¡ç›¸å…³æ ·å¼
- **toolbar.css**: å·¥å…·æ æ ·å¼
- **milestones.css**: é‡Œç¨‹ç¢‘æ ·å¼

## å¼€å‘æŒ‡å¯¼åŸåˆ™

### ä»£ç ç»„ç»‡åŸåˆ™
1. **å•ä¸€èŒè´£**: æ¯ä¸ªæ–‡ä»¶å’Œç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸ
2. **æ¨¡å—åŒ–**: é€šè¿‡æ¸…æ™°çš„å¯¼å…¥å¯¼å‡ºç®¡ç†ä¾èµ–å…³ç³»
3. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
4. **æ€§èƒ½ä¼˜åŒ–**: æ‡’åŠ è½½ã€è®°å¿†åŒ–ã€äº‹ä»¶èŠ‚æµç­‰æŠ€æœ¯

### æ¶æ„ä¼˜åŠ¿
1. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„åˆ†å±‚å’Œæ¨¡å—åŒ–è®¾è®¡
2. **å¯æ‰©å±•æ€§**: Hookç³»ç»Ÿæ”¯æŒåŠŸèƒ½çš„çµæ´»ç»„åˆ
3. **å¯æµ‹è¯•æ€§**: ä¸šåŠ¡é€»è¾‘ä¸UIåˆ†ç¦»ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
4. **å¼€å‘ä½“éªŒ**: å®Œæ•´çš„ç±»å‹æç¤ºå’Œé”™è¯¯å¤„ç†

## ğŸ“‹ æœ€æ–°åŠŸèƒ½æ‰©å±•ï¼šä»»åŠ¡æ ‡é¢˜å³é”®èœå•ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°ï¼ˆ2025-07-20 æ–°å¢ï¼‰

ä¸ºä»»åŠ¡æ ‡é¢˜åˆ—æ·»åŠ äº†ç‹¬ç«‹çš„å³é”®èœå•ç³»ç»Ÿï¼Œæä¾›ä»»åŠ¡åç§°ç¼–è¾‘å’Œå›¾æ ‡é€‰æ‹©åŠŸèƒ½ï¼Œä¸ç”˜ç‰¹å›¾åŒºåŸŸçš„ä»»åŠ¡èœå•å®Œå…¨åˆ†ç¦»ã€‚

### æ¶æ„è®¾è®¡

#### 1. ç»„ä»¶æ¶æ„
```
TaskTitleItem.tsx (å·²æ‰©å±•)
â”œâ”€â”€ çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ ç¼–è¾‘çŠ¶æ€ (isEditing)
â”‚   â”œâ”€â”€ èœå•çŠ¶æ€ (contextMenu)
â”‚   â””â”€â”€ ç¼–è¾‘å€¼ (editValue)
â”œâ”€â”€ äº‹ä»¶å¤„ç†
â”‚   â”œâ”€â”€ å³é”®èœå•è§¦å‘ (handleContextMenu)
â”‚   â”œâ”€â”€ å†…è”ç¼–è¾‘æ§åˆ¶ (handleStartNameEdit, handleConfirmEdit)
â”‚   â””â”€â”€ å›¾æ ‡é€‰æ‹© (handleIconChange)
â””â”€â”€ UI æ¸²æŸ“
    â”œâ”€â”€ å†…è”ç¼–è¾‘è¾“å…¥æ¡†
    â””â”€â”€ TaskTitleContextMenu ç»„ä»¶

TaskTitleContextMenu.tsx (æ–°å¢)
â”œâ”€â”€ ä¸»èœå•
â”‚   â”œâ”€â”€ æ›´æ”¹ä»»åŠ¡åç§°
â”‚   â””â”€â”€ æ›´æ”¹ä»»åŠ¡å›¾æ ‡ (æ‚¬åœå±•å¼€)
â””â”€â”€ äºŒçº§èœå•
    â””â”€â”€ å›¾æ ‡é€‰æ‹©å™¨ (5ç§å›¾æ ‡ç±»å‹)
```

#### 2. æ•°æ®æµè®¾è®¡
```
ç”¨æˆ·äº¤äº’ â†’ TaskTitleItem â†’ handleTaskUpdate â†’ æ•°æ®æµä¼ é€’

æ•°æ®æµä¼ é€’è·¯å¾„ï¼š
GanttStateManager.handleTaskUpdate
    â†“
GanttEventCoordinator.handleTaskUpdate
    â†“
GanttContainer.onTaskUpdate
    â†“
GanttChartBody.onTaskUpdate
    â†“
TaskTitleColumn.onTaskUpdate
    â†“
TaskTitleItem.onTaskUpdate
    â†“
setTasks çŠ¶æ€æ›´æ–°
```

#### 3. æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

**3.1 ä»»åŠ¡åç§°å†…è”ç¼–è¾‘**
- è§¦å‘ï¼šç‚¹å‡»"æ›´æ”¹ä»»åŠ¡åç§°"èœå•é¡¹
- ç¼–è¾‘æ¨¡å¼ï¼šåŸä½ç½®è¾“å…¥æ¡†æ›¿æ¢æ–‡æœ¬
- äº¤äº’ï¼šEnterç¡®è®¤ã€Escapeå–æ¶ˆã€ç‚¹å‡»å¤–éƒ¨ç¡®è®¤
- æ•°æ®æ›´æ–°ï¼šé€šè¿‡ `handleTaskUpdate` ç›´æ¥æ›´æ–°ä»»åŠ¡ title å­—æ®µ

**3.2 ä»»åŠ¡å›¾æ ‡é€‰æ‹©**
- è§¦å‘ï¼šæ‚¬åœ"æ›´æ”¹ä»»åŠ¡å›¾æ ‡"èœå•é¡¹
- æ˜¾ç¤ºï¼šäºŒçº§èœå•åœ¨ä¸»èœå•å³ä¾§å±•å¼€
- é€‰é¡¹ï¼šdefault, milestone, development, testing, delivery
- æ•°æ®æ›´æ–°ï¼šé€šè¿‡ `handleTaskUpdate` ç›´æ¥æ›´æ–°ä»»åŠ¡ type å­—æ®µ

**3.3 èœå•ç³»ç»Ÿç‹¬ç«‹æ€§**
- **ä»»åŠ¡æ ‡é¢˜èœå•**ï¼šä¸“æ³¨äºä»»åŠ¡åŸºæœ¬ä¿¡æ¯ç¼–è¾‘ï¼ˆåç§°+å›¾æ ‡ï¼‰
- **ç”˜ç‰¹å›¾ä»»åŠ¡èœå•**ï¼šä¸“æ³¨äºä»»åŠ¡å±æ€§ç®¡ç†ï¼ˆé¢œè‰²+æ ‡ç­¾+åˆ é™¤ï¼‰
- å®Œå…¨ç‹¬ç«‹çš„ç»„ä»¶å’Œäº‹ä»¶å¤„ç†ï¼Œæ— äº¤å‰ä¾èµ–

#### 4. æŠ€æœ¯å®ç°è¦ç‚¹

**4.1 çŠ¶æ€ç®¡ç†**
```typescript
// TaskTitleItem.tsx ä¸­çš„å…³é”®çŠ¶æ€
const [isEditing, setIsEditing] = useState(false);
const [editValue, setEditValue] = useState(task.title);
const [contextMenu, setContextMenu] = useState({
  visible: false,
  x: 0,
  y: 0
});
```

**4.2 ä»»åŠ¡æ›´æ–°å‡½æ•°**
```typescript
// GanttStateManager.tsx ä¸­çš„æ ¸å¿ƒå‡½æ•°
const handleTaskUpdate = useCallback((taskId: string, updates: Partial<Task>) => {
  setTasks(prevTasks => 
    prevTasks.map(task => 
      task.id === taskId 
        ? { ...task, ...updates }
        : task
    )
  );
}, [setTasks]);
```

**4.3 èœå•å®šä½ç®—æ³•**
```typescript
// å³é”®èœå•ä½ç½®è®¡ç®—
setContextMenu({
  visible: true,
  x: e.clientX,  // é¼ æ ‡ç›¸å¯¹è§†å£çš„Xåæ ‡
  y: e.clientY   // é¼ æ ‡ç›¸å¯¹è§†å£çš„Yåæ ‡
});

// äºŒçº§èœå•ä½ç½®è®¡ç®—
const submenuStyle = {
  left: x + 160,  // ä¸»èœå•å®½åº¦ + é—´è·
  top: y
};
```

#### 5. æ‰©å±•å½±å“åˆ†æ

**5.1 æ–°å¢æ–‡ä»¶**
- `src/components/gantt/TaskTitleContextMenu.tsx` - ç‹¬ç«‹å³é”®èœå•ç»„ä»¶

**5.2 ä¿®æ”¹æ–‡ä»¶åŠå½±å“**
- `TaskTitleItem.tsx` - é›†æˆèœå•åŠŸèƒ½ï¼Œæ·»åŠ å†…è”ç¼–è¾‘
- `TaskTitleColumn.tsx` - æ·»åŠ  onTaskUpdate props ä¼ é€’
- `GanttChartBody.tsx` - ä¼ é€’ä»»åŠ¡æ›´æ–°å‡½æ•°
- `GanttContainer.tsx` - æ•°æ®æµä¼ é€’
- `GanttEventCoordinator.tsx` - äº‹ä»¶åè°ƒæ‰©å±•
- `GanttStateManager.tsx` - æ·»åŠ ä»»åŠ¡æ›´æ–°æ ¸å¿ƒé€»è¾‘
- `GanttChart.tsx` - é¡¶å±‚æ•°æ®æµé›†æˆ

**5.3 æ¶æ„å…¼å®¹æ€§**
- âœ… å®Œå…¨å…¼å®¹ç°æœ‰æ¶æ„æ¨¡å¼
- âœ… æ— ç ´åæ€§å˜æ›´
- âœ… éµå¾ªç°æœ‰çš„æ•°æ®æµè®¾è®¡
- âœ… ä¿æŒç»„ä»¶èŒè´£å•ä¸€åŸåˆ™

#### 6. æ€§èƒ½è€ƒè™‘

**6.1 ä¼˜åŒ–ç­–ç•¥**
- ä½¿ç”¨ `useCallback` ä¼˜åŒ–äº‹ä»¶å¤„ç†å‡½æ•°
- èœå•ç»„ä»¶æŒ‰éœ€æ¸²æŸ“ï¼ˆvisible æ§åˆ¶ï¼‰
- å†…è”ç¼–è¾‘ä½¿ç”¨ ref ç›´æ¥æ“ä½œ DOM

**6.2 å†…å­˜ç®¡ç†**
- æ­£ç¡®çš„äº‹ä»¶ç›‘å¬å™¨æ¸…ç†
- ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†çŠ¶æ€
- é¿å…å†…å­˜æ³„æ¼çš„å®šæ—¶å™¨å¤„ç†

#### 7. è°ƒè¯•å’Œç»´æŠ¤

**7.1 è°ƒè¯•å·¥å…·**
- React DevTools æŸ¥çœ‹çŠ¶æ€å˜åŒ–
- æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥äº‹ä»¶ç»‘å®š
- TypeScript ç¼–è¯‘æ£€æŸ¥ç±»å‹å®‰å…¨

**7.2 å¸¸è§é—®é¢˜**
- èœå•å®šä½é—®é¢˜ï¼šæ£€æŸ¥åæ ‡è®¡ç®—
- ç¼–è¾‘çŠ¶æ€å¼‚å¸¸ï¼šéªŒè¯ ref èšç„¦
- æ•°æ®ä¸æ›´æ–°ï¼šç¡®è®¤å‡½æ•°ä¼ é€’é“¾

## ğŸ”„ é‡æ„æ¶æ„ä¼˜åŒ– (2025-07-20)

### é‡æ„èƒŒæ™¯
åŸºäºCLAUDE.mdçš„ä»£ç ç®€æ´æ€§è¦æ±‚ï¼Œå¯¹è¶…å¤§æ–‡ä»¶è¿›è¡Œæ¨¡å—åŒ–æ‹†åˆ†ï¼Œè§£å†³ä»£ç å¯ç»´æŠ¤æ€§é—®é¢˜ã€‚

### é‡æ„ç›®æ ‡
- **GanttStateManager.tsx**: 423è¡Œ â†’ <300è¡Œï¼ˆæ ¸å¿ƒç»„ä»¶é™åˆ¶ï¼‰
- **useGanttUIState.ts**: 345è¡Œ â†’ <200è¡Œï¼ˆHooké™åˆ¶ï¼‰

### é‡æ„æˆæœ

#### 1. GanttStateManager æ¨¡å—åŒ–é‡æ„

**é‡æ„å‰é—®é¢˜**:
- å•ä½“æ–‡ä»¶423è¡Œï¼ŒèŒè´£è¿‡å¤š
- åŒ…å«ï¼šå®¹å™¨ç®¡ç†ã€çŠ¶æ€èšåˆã€è®¡ç®—é€»è¾‘ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†
- Hookè°ƒç”¨ä¼—å¤šï¼ŒçŠ¶æ€æ¥å£åºå¤§ï¼ˆ110è¡Œinterfaceå®šä¹‰ï¼‰

**é‡æ„åæ¶æ„**:
```
src/components/gantt/
â”œâ”€â”€ GanttStateManager.tsx          // ä¸»åè°ƒå™¨ (144è¡Œ)
â””â”€â”€ state/
    â”œâ”€â”€ GanttStateTypes.ts         // ç±»å‹å®šä¹‰ (88è¡Œ)
    â”œâ”€â”€ GanttContainerManager.tsx  // å®¹å™¨ç®¡ç† (47è¡Œ)
    â””â”€â”€ GanttStateCalculations.ts  // è®¡ç®—é€»è¾‘ (130è¡Œ)
```

**ä¼˜åŒ–æ•ˆæœ**:
- **æ–‡ä»¶å¤§å°**: 423è¡Œ â†’ 144è¡Œ (**-66%**)
- **èŒè´£åˆ†ç¦»**: åè°ƒã€ç±»å‹ã€å®¹å™¨ã€è®¡ç®—å„å¸å…¶èŒ
- **å¯ç»´æŠ¤æ€§**: å•ä¸ªæ–‡ä»¶æœ€å¤§130è¡Œï¼Œæ˜“äºç†è§£

#### 2. useGanttUIState æ¨¡å—åŒ–é‡æ„

**é‡æ„å‰é—®é¢˜**:
- å•ä½“Hookæ–‡ä»¶345è¡Œï¼ŒåŒ…å«å¤šä¸ªç‹¬ç«‹åŠŸèƒ½åŸŸ
- åŒ…å«ï¼šé€‰æ‹©ç®¡ç†ã€èœå•ç®¡ç†ã€æ¨¡æ€æ¡†ç®¡ç†ã€æ ‡ç­¾æ“ä½œã€é”®ç›˜å¤„ç†

**é‡æ„åæ¶æ„**:
```
src/hooks/gantt/
â”œâ”€â”€ useGanttUIState.ts       // ä¸»å…¥å£ (122è¡Œ)
â””â”€â”€ ui/
    â”œâ”€â”€ useSelectionState.ts // é€‰æ‹©çŠ¶æ€ (42è¡Œ)
    â”œâ”€â”€ useMenuState.ts      // èœå•çŠ¶æ€ (80è¡Œ)
    â”œâ”€â”€ useModalState.ts     // æ¨¡æ€æ¡†çŠ¶æ€ (148è¡Œ)
    â””â”€â”€ useUIKeyboard.ts     // é”®ç›˜å¤„ç† (67è¡Œ)
```

**ä¼˜åŒ–æ•ˆæœ**:
- **æ–‡ä»¶å¤§å°**: 345è¡Œ â†’ 122è¡Œ (**-65%**)
- **åŠŸèƒ½åˆ†ç¦»**: æŒ‰åŠŸèƒ½åŸŸæ¸…æ™°åˆ†ç¦»
- **å¤ç”¨æ€§**: å­æ¨¡å—å¯ç‹¬ç«‹ä½¿ç”¨

### æ¶æ„æ”¹è¿›åˆ†æ

#### 1. æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

**çŠ¶æ€ç®¡ç†å±‚é‡æ„**:
- **ç±»å‹å®šä¹‰åˆ†ç¦»**: å°†88è¡Œç±»å‹å®šä¹‰ç‹¬ç«‹ä¸ºGanttStateTypes.ts
- **å®¹å™¨é€»è¾‘åˆ†ç¦»**: å°†å®¹å™¨å°ºå¯¸ç®¡ç†ç‹¬ç«‹ä¸ºGanttContainerManager.tsx
- **è®¡ç®—é€»è¾‘åˆ†ç¦»**: å°†130è¡Œå¤æ‚è®¡ç®—ç‹¬ç«‹ä¸ºGanttStateCalculations.ts
- **åè°ƒå™¨ä¼˜åŒ–**: ä¸»æ–‡ä»¶ä¸“æ³¨äºHookç»„åˆå’Œæ•°æ®æµåè°ƒ

**UIçŠ¶æ€å±‚é‡æ„**:
- **é€‰æ‹©çŠ¶æ€**: ä»»åŠ¡é€‰æ‹©é€»è¾‘ç‹¬ç«‹ç®¡ç†
- **èœå•çŠ¶æ€**: ä¸Šä¸‹æ–‡èœå•å’Œä»»åŠ¡èœå•åˆ†ç¦»
- **æ¨¡æ€æ¡†çŠ¶æ€**: é¢œè‰²é€‰æ‹©å™¨å’Œæ ‡ç­¾ç®¡ç†å™¨ç»Ÿä¸€ç®¡ç†
- **é”®ç›˜å¤„ç†**: UIç›¸å…³é”®ç›˜äº‹ä»¶ç‹¬ç«‹å¤„ç†

#### 2. ä»£ç è´¨é‡æå‡

**ç¬¦åˆCLAUDE.mdè§„èŒƒ**:
- âœ… æ ¸å¿ƒç»„ä»¶<300è¡Œ: GanttStateManager 144è¡Œ
- âœ… Hookæ–‡ä»¶<200è¡Œ: useGanttUIState 122è¡Œ
- âœ… å•ä¸€èŒè´£: æ¯ä¸ªæ–‡ä»¶åŠŸèƒ½å•ä¸€
- âœ… æ¨¡å—åŒ–: æŒ‰åŠŸèƒ½åŸŸæ¸…æ™°åˆ†ç¦»

**å¯ç»´æŠ¤æ€§æå‡**:
- **æ–‡ä»¶å¤§å°æ§åˆ¶**: æ‰€æœ‰æ–°å¢æ–‡ä»¶<150è¡Œ
- **èŒè´£æ¸…æ™°**: æ¯ä¸ªæ¨¡å—åŠŸèƒ½æ˜ç¡®
- **ä¾èµ–ç®€åŒ–**: å‡å°‘æ¨¡å—é—´è€¦åˆ
- **æµ‹è¯•å‹å¥½**: å°æ¨¡å—æ˜“äºå•å…ƒæµ‹è¯•

#### 3. æ€§èƒ½å½±å“åˆ†æ

**æ„å»ºæ€§èƒ½**:
- **ç¼–è¯‘é€Ÿåº¦**: å°æ–‡ä»¶ç¼–è¯‘æ›´å¿«
- **å¼€å‘ä½“éªŒ**: æ–‡ä»¶åŠ è½½å’Œæ™ºèƒ½æç¤ºæ›´å¿«
- **å†…å­˜å ç”¨**: æŒ‰éœ€åŠ è½½å‡å°‘å†…å­˜æ¶ˆè€—

**è¿è¡Œæ—¶æ€§èƒ½**:
- **æ— æ€§èƒ½æŸå¤±**: é‡æ„ä¸å½±å“è¿è¡Œæ—¶æ€§èƒ½
- **ä»£ç åˆ†å‰²**: æ”¯æŒæ›´ç»†ç²’åº¦çš„ä»£ç åˆ†å‰²
- **ç¼“å­˜å‹å¥½**: å°æ–‡ä»¶æ›´åˆ©äºæµè§ˆå™¨ç¼“å­˜

#### 4. å‘åå…¼å®¹æ€§

**æ¥å£å…¼å®¹**:
- âœ… å¯¼å‡ºæ¥å£å®Œå…¨å…¼å®¹
- âœ… ç»„ä»¶ä½¿ç”¨æ–¹å¼ä¸å˜
- âœ… Hookè°ƒç”¨æ–¹å¼ä¸å˜
- âœ… ç±»å‹å®šä¹‰ä¿æŒä¸€è‡´

**è¿ç§»æˆæœ¬**:
- **é›¶ç ´åæ€§å˜æ›´**: ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
- **æ¸è¿›å¼å‡çº§**: å¯æŒ‰æ¨¡å—é€æ­¥ä¼˜åŒ–
- **å›æ»šå‹å¥½**: ä¿ç•™å¤‡ä»½æ–‡ä»¶ä¾¿äºå›æ»š

### é‡æ„éªŒè¯

#### 1. æ„å»ºéªŒè¯
```bash
pnpm run build  # âœ… æ„å»ºæˆåŠŸï¼Œæ— TypeScripté”™è¯¯
```

#### 2. æ–‡ä»¶å¤§å°éªŒè¯
| æ–‡ä»¶ | é‡æ„å‰ | é‡æ„å | æ”¹å–„ |
|------|--------|--------|------|
| GanttStateManager.tsx | 423è¡Œ | 144è¡Œ | **-66%** |
| useGanttUIState.ts | 345è¡Œ | 122è¡Œ | **-65%** |
| **æ€»ä½“ç¬¦åˆç‡** | 0/2 | 2/2 | **100%** |

#### 3. ä»£ç è´¨é‡éªŒè¯
- âœ… æ‰€æœ‰æ–°æ–‡ä»¶<150è¡Œ
- âœ… åŠŸèƒ½å®Œæ•´æ€§ä¿æŒ
- âœ… ç±»å‹å®‰å…¨æ€§ä¿æŒ
- âœ… æ€§èƒ½æ— æŸå¤±

### å¼€å‘æŒ‡å¯¼

#### 1. æ–°å¢åŠŸèƒ½å¼€å‘
- **çŠ¶æ€ç›¸å…³**: åœ¨å¯¹åº”çš„state/å­æ¨¡å—ä¸­æ‰©å±•
- **UIç›¸å…³**: åœ¨å¯¹åº”çš„ui/å­æ¨¡å—ä¸­æ‰©å±•
- **ä¿æŒå•æ–‡ä»¶<150è¡Œ**: è¶…å‡ºæ—¶ç»§ç»­æ‹†åˆ†

#### 2. ç»´æŠ¤å»ºè®®
- **å®šæœŸæ£€æŸ¥æ–‡ä»¶å¤§å°**: ä½¿ç”¨`wc -l`å‘½ä»¤ç›‘æ§
- **éµå¾ªæ¨¡å—åŒ–åŸåˆ™**: æ–°åŠŸèƒ½æŒ‰åŠŸèƒ½åŸŸåˆ†ç±»
- **ä¿æŒæ¥å£ç¨³å®š**: é¿å…é¢‘ç¹ä¿®æ”¹å¯¼å‡ºæ¥å£

#### 3. æœªæ¥ä¼˜åŒ–æ–¹å‘
- **Hookç»„åˆä¼˜åŒ–**: è¿›ä¸€æ­¥ä¼˜åŒ–Hookç»„åˆç­–ç•¥
- **æ€§èƒ½ç›‘æ§**: å»ºç«‹æ–‡ä»¶å¤§å°ç›‘æ§æœºåˆ¶
- **è‡ªåŠ¨åŒ–é‡æ„**: å¼€å‘è‡ªåŠ¨é‡æ„å·¥å…·

## ğŸš€ æœ€æ–°åŠŸèƒ½æ‰©å±•ï¼šåˆ†å±‚æ—¶é—´è½´æ˜¾ç¤ºæŠ€æœ¯ (2025-07-22)

### åŠŸèƒ½æ¦‚è¿°

å®ç°äº†å¯é…ç½®çš„åˆ†å±‚æ—¶é—´è½´æ˜¾ç¤ºæŠ€æœ¯ï¼Œæ”¯æŒ2å±‚å’Œ3å±‚æ—¶é—´è½´çš„åŠ¨æ€åˆ‡æ¢ï¼Œæå‡äº†ä¸åŒæ—¶é—´é¢—ç²’åº¦ä¸‹çš„ç”˜ç‰¹å›¾æ˜¾ç¤ºæ•ˆæœã€‚

### æŠ€æœ¯æ¶æ„è®¾è®¡

#### 1. æ ¸å¿ƒç»„ä»¶æ¶æ„
```
åˆ†å±‚æ—¶é—´è½´ç³»ç»Ÿ
â”œâ”€â”€ LayeredTimelineHeader.tsx        # åˆ†å±‚æ—¶é—´è½´æ¸²æŸ“å™¨ (113è¡Œ)
â”œâ”€â”€ TimelineLayerSettings.tsx        # æ—¶é—´è½´è®¾ç½®æ§åˆ¶å™¨
â”œâ”€â”€ TimelineSettingsPanel.tsx        # è®¾ç½®é¢æ¿ç»„ä»¶
â””â”€â”€ settings/
    â”œâ”€â”€ GranularitySelector.tsx      # é¢—ç²’åº¦é€‰æ‹©å™¨
    â””â”€â”€ LayerCountSelector.tsx       # å±‚æ•°é€‰æ‹©å™¨
```

#### 2. Hookç³»ç»Ÿæ¶æ„
```
åˆ†å±‚æ—¶é—´è½´Hookç³»ç»Ÿ
â”œâ”€â”€ useLayeredTimeline.ts           # æ—¶é—´è½´æ•°æ®ç”ŸæˆHook (48è¡Œ)
â””â”€â”€ useTimelineSettings.ts          # è®¾ç½®çŠ¶æ€ç®¡ç†Hook (87è¡Œ)
```

#### 3. å·¥å…·å‡½æ•°æ¶æ„
```
å·¥å…·å‡½æ•°ç³»ç»Ÿ
â””â”€â”€ timelineLayerUtils.ts          # åˆ†å±‚è®¡ç®—æ ¸å¿ƒå·¥å…· (280è¡Œ)
    â”œâ”€â”€ æ—¶é—´é¢—ç²’åº¦å¤„ç†
    â”œâ”€â”€ åˆ†å±‚æ•°æ®ç”Ÿæˆç®—æ³•
    â””â”€â”€ æ ‡ç­¾æ ¼å¼åŒ–å·¥å…·
```

### æŠ€æœ¯å®ç°è¦ç‚¹

#### 1. æ•°æ®ç»“æ„è®¾è®¡

**æ—¶é—´è½´å±‚æ¬¡é…ç½®æ¥å£**:
```typescript
interface TimelineLayerConfig {
  layers: 2 | 3;                    // æ”¯æŒ2å±‚æˆ–3å±‚
  bottom: TimeGranularity;          // åº•å±‚é¢—ç²’åº¦ (day|week|month)
  middle?: TimeGranularity;         // ä¸­å±‚é¢—ç²’åº¦ (week|month|quarter)
  top?: TimeGranularity;            // é¡¶å±‚é¢—ç²’åº¦ (month|quarter|year)
}
```

**åˆ†å±‚æ—¶é—´åˆ»åº¦æ•°æ®ç»“æ„**:
```typescript
interface LayeredTimeScale {
  layers: TimeScaleLayer[];         // æ—¶é—´è½´å±‚çº§æ•°ç»„
  totalHeight: number;              // æ€»é«˜åº¦ (55px)
}

interface TimeScaleLayer {
  type: TimeGranularity;           // æ—¶é—´é¢—ç²’åº¦ç±»å‹
  items: TimeScaleItem[];          // æ—¶é—´åˆ»åº¦é¡¹æ•°ç»„
  height: number;                  // å±‚çº§é«˜åº¦
  level: number;                   // å±‚çº§åºå· (0=åº•å±‚, 1=ä¸­å±‚, 2=é¡¶å±‚)
}
```

#### 2. ç®—æ³•å®ç°æ ¸å¿ƒ

**åˆ†å±‚è®¡ç®—ç®—æ³•**:
```typescript
// src/utils/timelineLayerUtils.ts:254
export const generateLayeredTimeScales = (
  config: TimelineLayerConfig,
  dateRange: DateRange,
  dateToPixel: (date: Date) => number
): LayeredTimeScale => {
  const layers: TimeScaleLayer[] = [];
  const layerHeight = 55 / config.layers; // ç­‰é«˜åˆ†é…

  // åŠ¨æ€ç”Ÿæˆå„å±‚æ—¶é—´åˆ»åº¦
  if (config.layers === 2) {
    layers.push(
      generateTimeScaleLayer(config.middle!, 1, layerHeight, dateRange, dateToPixel),
      generateTimeScaleLayer(config.bottom, 0, layerHeight, dateRange, dateToPixel)
    );
  } else if (config.layers === 3) {
    layers.push(
      generateTimeScaleLayer(config.top!, 2, layerHeight, dateRange, dateToPixel),
      generateTimeScaleLayer(config.middle!, 1, layerHeight, dateRange, dateToPixel),
      generateTimeScaleLayer(config.bottom, 0, layerHeight, dateRange, dateToPixel)
    );
  }

  return { layers, totalHeight: 55 };
};
```

**å‘¨æ•°è®¡ç®—ç®—æ³•** (å‘¨ä¸€å¼€å§‹æ ‡å‡†):
```typescript
// src/utils/timelineLayerUtils.ts:62
export const getWeekOfYear = (date: Date): number => {
  const start = new Date(date.getFullYear(), 0, 1);
  const diff = date.getTime() - start.getTime();
  const day = Math.floor(diff / (24 * 60 * 60 * 1000)) + 1;
  const startDay = start.getDay() || 7; // å‘¨æ—¥=7
  return Math.ceil((day + startDay - 2) / 7);
};
```

#### 3. æ¸²æŸ“å®ç°æŠ€æœ¯

**åˆ†å±‚æ¸²æŸ“ç»„ä»¶** (`LayeredTimelineHeader.tsx`):
- **å¤šå±‚æ—¶é—´è½´**: åŸºäºé…ç½®åŠ¨æ€ç”Ÿæˆæ—¶é—´å±‚çº§
- **å‚ç›´ç½‘æ ¼çº¿**: ä½¿ç”¨åº•å±‚æ—¶é—´åˆ»åº¦ç”Ÿæˆç½‘æ ¼å¯¹é½
- **å½“å‰æ—¥æœŸçº¿**: çº¢è‰²æŒ‡ç¤ºçº¿æ˜¾ç¤ºå½“å‰æ—¥æœŸä½ç½®
- **å±‚çº§åˆ†éš”**: æ¯å±‚ä¹‹é—´æ·»åŠ è¾¹æ¡†åˆ†éš”çº¿

**æ€§èƒ½ä¼˜åŒ–æªæ–½**:
- **useMemoç¼“å­˜**: æ—¶é—´åˆ»åº¦æ•°æ®ç”Ÿæˆç¼“å­˜
- **ç­‰é«˜åˆ†é…**: 55pxæ€»é«˜åº¦æŒ‰å±‚æ•°ç­‰åˆ†
- **æ ‡ç­¾ä¼˜åŒ–**: é˜²æ­¢æ–‡æœ¬æº¢å‡ºå’Œæ¢è¡Œ

#### 4. çŠ¶æ€ç®¡ç†è®¾è®¡

**è®¾ç½®çŠ¶æ€ç®¡ç†Hook** (`useTimelineSettings.ts`):
```typescript
const useTimelineSettings = (initialConfig?: TimelineLayerConfig) => {
  const [config, setConfig] = useState<TimelineLayerConfig>(
    initialConfig || DEFAULT_CONFIG
  );
  const [isPanelOpen, setIsPanelOpen] = useState(false);

  // é…ç½®éªŒè¯å’Œæ›´æ–°é€»è¾‘
  const updateConfig = useCallback((newConfig: Partial<TimelineLayerConfig>) => {
    setConfig(prev => {
      const mergedConfig = { ...prev, ...newConfig };
      return validateConfig(mergedConfig);
    });
  }, [validateConfig]);

  return { config, updateConfig, isPanelOpen, setIsPanelOpen, resetToDefault };
};
```

### æ¶æ„é›†æˆæ–¹å¼

#### 1. ä¸ç°æœ‰æ—¶é—´è½´ç³»ç»Ÿé›†æˆ

**TimelineHeader.tsx é›†æˆæ–¹å¼**:
- ä¿æŒç°æœ‰å•å±‚æ—¶é—´è½´ä½œä¸ºé»˜è®¤æ¨¡å¼
- é€šè¿‡ `useTimelineSettings` Hook æ§åˆ¶åˆ†å±‚æ˜¾ç¤º
- åˆ†å±‚æ¨¡å¼ä¸‹æ›¿æ¢ä¸º `LayeredTimelineHeader` ç»„ä»¶æ¸²æŸ“

#### 2. é…ç½®ç³»ç»Ÿé›†æˆ

**è®¾ç½®é¢æ¿é›†æˆ**:
- åœ¨ `Toolbar.tsx` ä¸­æ·»åŠ æ—¶é—´è½´è®¾ç½®æŒ‰é’®
- é€šè¿‡ `TimelineSettingsPanel` æä¾›å¯è§†åŒ–é…ç½®ç•Œé¢
- æ”¯æŒå®æ—¶é¢„è§ˆå’Œé…ç½®ä¿å­˜

#### 3. æ•°æ®æµé›†æˆ

**æ•°æ®æµä¼ é€’è·¯å¾„**:
```
GanttChart.tsx (æ—¶é—´è½´é…ç½®çŠ¶æ€)
    â†“
GanttContainer.tsx (é…ç½®ä¼ é€’)
    â†“
GanttChartHeader.tsx (å¤´éƒ¨æ¸²æŸ“æ§åˆ¶)
    â†“
TimelineHeader.tsx (åˆ†å±‚æ¨¡å¼åˆ¤æ–­)
    â†“
LayeredTimelineHeader.tsx (åˆ†å±‚æ¸²æŸ“)
```

### æŠ€æœ¯ä¼˜åŠ¿åˆ†æ

#### 1. çµæ´»æ€§ä¼˜åŠ¿
- **å¯é…ç½®å±‚æ•°**: æ”¯æŒ2å±‚/3å±‚åŠ¨æ€åˆ‡æ¢
- **é¢—ç²’åº¦ç»„åˆ**: 5ç§æ—¶é—´é¢—ç²’åº¦è‡ªç”±ç»„åˆ
- **å®æ—¶åˆ‡æ¢**: æ— éœ€åˆ·æ–°å³å¯åˆ‡æ¢æ˜¾ç¤ºæ¨¡å¼

#### 2. æ€§èƒ½ä¼˜åŠ¿
- **æŒ‰éœ€è®¡ç®—**: åªåœ¨é…ç½®å˜æ›´æ—¶é‡æ–°è®¡ç®—
- **æ•°æ®ç¼“å­˜**: ä½¿ç”¨ `useMemo` ä¼˜åŒ–è®¡ç®—æ€§èƒ½
- **æ¸²æŸ“ä¼˜åŒ–**: é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“

#### 3. ç”¨æˆ·ä½“éªŒä¼˜åŠ¿
- **è§†è§‰å±‚æ¬¡**: æ¸…æ™°çš„æ—¶é—´å±‚çº§æ˜¾ç¤º
- **ä¿¡æ¯å¯†åº¦**: åŒæ—¶æ˜¾ç¤ºå¤šä¸ªæ—¶é—´ç»´åº¦ä¿¡æ¯
- **ä¸€è‡´æ€§**: ç½‘æ ¼çº¿ä¸æ—¶é—´è½´å®Œç¾å¯¹é½

### æ‰©å±•å½±å“åˆ†æ

#### 1. æ–°å¢æ–‡ä»¶æ¸…å•
```
src/components/gantt/
â”œâ”€â”€ LayeredTimelineHeader.tsx        # åˆ†å±‚æ—¶é—´è½´ä¸»ç»„ä»¶
â”œâ”€â”€ TimelineLayerSettings.tsx        # è®¾ç½®æ§åˆ¶å™¨
â”œâ”€â”€ TimelineSettingsPanel.tsx        # è®¾ç½®é¢æ¿
â””â”€â”€ settings/
    â”œâ”€â”€ GranularitySelector.tsx      # é¢—ç²’åº¦é€‰æ‹©å™¨
    â””â”€â”€ LayerCountSelector.tsx       # å±‚æ•°é€‰æ‹©å™¨

src/hooks/gantt/
â”œâ”€â”€ useLayeredTimeline.ts           # æ—¶é—´è½´æ•°æ®Hook
â””â”€â”€ useTimelineSettings.ts          # è®¾ç½®çŠ¶æ€Hook

src/utils/
â””â”€â”€ timelineLayerUtils.ts           # æ ¸å¿ƒç®—æ³•å·¥å…·
```

#### 2. æ¶æ„å…¼å®¹æ€§éªŒè¯
- âœ… **å‘åå…¼å®¹**: ç°æœ‰æ—¶é—´è½´åŠŸèƒ½å®Œå…¨ä¿æŒ
- âœ… **æ— ç ´åæ€§**: åˆ†å±‚åŠŸèƒ½ä½œä¸ºå¯é€‰å¢å¼º
- âœ… **æ¨¡å—ç‹¬ç«‹**: æ–°åŠŸèƒ½æ¨¡å—å®Œå…¨ç‹¬ç«‹
- âœ… **æ€§èƒ½æ— æŸ**: ä¸å½±å“ç°æœ‰æ€§èƒ½è¡¨ç°

#### 3. ä»£ç è´¨é‡æŒ‡æ ‡
```
æ–‡ä»¶å¤§å°æ§åˆ¶:
â”œâ”€â”€ LayeredTimelineHeader.tsx: 113è¡Œ âœ… (<150è¡Œ)
â”œâ”€â”€ useLayeredTimeline.ts: 48è¡Œ âœ… (<150è¡Œ)
â”œâ”€â”€ useTimelineSettings.ts: 87è¡Œ âœ… (<150è¡Œ)
â””â”€â”€ timelineLayerUtils.ts: 280è¡Œ âš ï¸ (å·¥å…·æ–‡ä»¶å…è®¸)

åŠŸèƒ½å®Œæ•´æ€§: 100% âœ…
ç±»å‹å®‰å…¨æ€§: 100% âœ…
æµ‹è¯•è¦†ç›–: å¾…å®æ–½ ğŸ“‹
```

## ğŸ—ï¸ é‡Œç¨‹ç¢‘èŠ‚ç‚¹ç³»ç»Ÿæ‰©å±• (2025-07-22)

### åŠŸèƒ½æ¦‚è¿°

å®ç°äº†ç‹¬ç«‹çš„é‡Œç¨‹ç¢‘èŠ‚ç‚¹ç³»ç»Ÿï¼Œæ”¯æŒä»»åŠ¡è¡Œä¸Šæ˜¾ç¤ºè±å½¢é‡Œç¨‹ç¢‘èŠ‚ç‚¹ï¼Œå…·å¤‡å›¾æ ‡ç»§æ‰¿ã€æ‹–æ‹½ç§»åŠ¨å’Œå³é”®èœå•ç­‰å®Œæ•´åŠŸèƒ½ã€‚

### æ¶æ„è®¾è®¡

#### 1. é‡Œç¨‹ç¢‘ç»„ä»¶æ¶æ„
```
é‡Œç¨‹ç¢‘ç³»ç»Ÿç»„ä»¶
â”œâ”€â”€ MilestoneNode.tsx              # é‡Œç¨‹ç¢‘èŠ‚ç‚¹æ¸²æŸ“ç»„ä»¶
â”œâ”€â”€ MilestoneTaskBar.tsx           # é‡Œç¨‹ç¢‘ä»»åŠ¡æ¡ç»„ä»¶
â”œâ”€â”€ MilestoneContextMenu.tsx       # é‡Œç¨‹ç¢‘å³é”®èœå•
â””â”€â”€ TaskBarsContainer.tsx          # ä»»åŠ¡æ¡å®¹å™¨ (é›†æˆé‡Œç¨‹ç¢‘)
```

#### 2. Hookç³»ç»Ÿæ¶æ„
```
é‡Œç¨‹ç¢‘Hookç³»ç»Ÿ
â”œâ”€â”€ useMilestoneManager.ts         # é‡Œç¨‹ç¢‘ç®¡ç†æ ¸å¿ƒHook
â”œâ”€â”€ useMilestoneDrag.ts           # é‡Œç¨‹ç¢‘æ‹–æ‹½å¤„ç†Hook
â””â”€â”€ useMilestoneAttachment.ts     # é‡Œç¨‹ç¢‘é™„ä»¶å…³è”Hook
```

#### 3. æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

**é‡Œç¨‹ç¢‘æ•°æ®ç»“æ„**:
```typescript
interface MilestoneNode {
  id: string;
  x: number;                      // æ—¶é—´è½´ä½ç½®
  y: number;                      // ä»»åŠ¡è¡Œä½ç½®
  date: Date;                     // é‡Œç¨‹ç¢‘æ—¥æœŸ
  taskId: string;                 // å…³è”ä»»åŠ¡ID
  iconType: TaskType;             // å›¾æ ‡ç±»å‹ (ç»§æ‰¿ä»»åŠ¡ç±»å‹)
  color?: string;                 // é¢œè‰² (å¯é€‰è¦†ç›–)
}
```

**å›¾æ ‡ç»§æ‰¿æœºåˆ¶**:
- é‡Œç¨‹ç¢‘èŠ‚ç‚¹è‡ªåŠ¨ç»§æ‰¿å…³è”é¡¹ç›®è¡Œçš„ä»»åŠ¡ç±»å‹å›¾æ ‡
- æ”¯æŒ5ç§å›¾æ ‡ç±»å‹: default, milestone, development, testing, delivery
- é¢œè‰²æ–¹æ¡ˆä¸ä»»åŠ¡å›¾æ ‡ä¿æŒä¸€è‡´

**æ‹–æ‹½äº¤äº’ç³»ç»Ÿ**:
- æ°´å¹³æ‹–æ‹½: ä¿®æ”¹é‡Œç¨‹ç¢‘æ—¥æœŸä½ç½®
- å‚ç›´æ‹–æ‹½: å…³è”åˆ°ä¸åŒé¡¹ç›®è¡Œ
- æ‹–æ‹½çº¦æŸ: é™åˆ¶åœ¨æœ‰æ•ˆçš„é¡¹ç›®è¡ŒèŒƒå›´å†…

### æŠ€æœ¯å®ç°è¦ç‚¹

**MilestoneNodeç»„ä»¶æ¸²æŸ“**:
```typescript
// è±å½¢èƒŒæ™¯ + å›¾æ ‡ç»„åˆæ¸²æŸ“
const MilestoneNode = ({ milestone, taskHeight, isSelected, isDragging }) => {
  const IconComponent = getIconComponent(milestone.iconType);
  const iconColor = getIconColor(milestone.iconType);
  
  return (
    <div className="milestone-node" style={{
      width: taskHeight,
      height: taskHeight,
      transform: 'rotate(45deg)',          // è±å½¢æ—‹è½¬
      backgroundColor: iconColor,
      // ... å…¶ä»–æ ·å¼
    }}>
      <IconComponent style={{
        transform: 'rotate(-45deg)',       // å›¾æ ‡åå‘æ—‹è½¬
        // ... å›¾æ ‡æ ·å¼
      }} />
    </div>
  );
};
```

### æ¶æ„é›†æˆåˆ†æ

#### 1. ä¸ä»»åŠ¡ç³»ç»Ÿé›†æˆ
- é‡Œç¨‹ç¢‘èŠ‚ç‚¹æ˜¾ç¤ºåœ¨é¡¹ç›®è¡Œä¸Šæ–¹
- ç»§æ‰¿é¡¹ç›®è¡Œçš„ä»»åŠ¡ç±»å‹å’Œé¢œè‰²è®¾ç½®
- æ”¯æŒä¸ä»»åŠ¡æ‹–æ‹½ç³»ç»Ÿåè°ƒå·¥ä½œ

#### 2. ä¸æ—¶é—´è½´ç³»ç»Ÿé›†æˆ
- é‡Œç¨‹ç¢‘ä½ç½®åŸºäº `dateToPixel` å‡½æ•°è®¡ç®—
- ä¸åˆ†å±‚æ—¶é—´è½´ç³»ç»Ÿå®Œç¾å…¼å®¹
- æ”¯æŒç¼©æ”¾å’Œæ—¶é—´èŒƒå›´å˜æ›´

#### 3. æ•°æ®æµé›†æˆ
```
é‡Œç¨‹ç¢‘æ•°æ®æµ
GanttStateManager (é‡Œç¨‹ç¢‘çŠ¶æ€ç®¡ç†)
    â†“
TaskBarsContainer (é‡Œç¨‹ç¢‘æ¸²æŸ“æ§åˆ¶)
    â†“
MilestoneNode (èŠ‚ç‚¹æ¸²æŸ“)
```

---

*æœ¬æ–‡æ¡£è®°å½•äº†Ganttoç”˜ç‰¹å›¾åº”ç”¨çš„å®Œæ•´ä»£ç æ¶æ„ï¼ŒåŒ…æ‹¬2025-07-20çš„ä»»åŠ¡æ ‡é¢˜å³é”®èœå•åŠŸèƒ½ã€é‡æ„æ¶æ„ä¼˜åŒ–ï¼Œä»¥åŠ2025-07-22çš„åˆ†å±‚æ—¶é—´è½´æ˜¾ç¤ºæŠ€æœ¯å’Œé‡Œç¨‹ç¢‘èŠ‚ç‚¹ç³»ç»Ÿçš„è¯¦ç»†æŠ€æœ¯å®ç°ã€‚*