# Gantto ç”˜ç‰¹å›¾åº”ç”¨ä»£ç æ¶æ„åˆ†æ

## æŠ€æœ¯æ ˆæ¦‚è§ˆ
- **å‰ç«¯æ¡†æ¶**: React 18 + TypeScript + Vite
- **åç«¯**: Tauri v2 (Rust)
- **UIç»„ä»¶åº“**: Radix UI
- **å›¾æ ‡åº“**: Lucide React
- **åŒ…ç®¡ç†å™¨**: pnpm

## æ ¸å¿ƒæ¶æ„æ¨¡å¼

### 1. åˆ†å±‚æ¶æ„è®¾è®¡
```
åº”ç”¨å±‚ (App.tsx)
â”œâ”€ è¡¨ç°å±‚ (Components)
â”œâ”€ ä¸šåŠ¡é€»è¾‘å±‚ (Hooks)
â”œâ”€ æ•°æ®è®¿é—®å±‚ (Types/Utils)
â””â”€ åŸºç¡€è®¾æ–½å±‚ (Styles/Assets)
```

### 2. ç»„ä»¶æ¶æ„

#### åº”ç”¨å…¥å£å±‚ `src/App.tsx:1`
- **åŠŸèƒ½**: åº”ç”¨æ ¹ç»„ä»¶ï¼Œå…¨å±€é”™è¯¯å¤„ç†
- **èŒè´£**: 
  - é¡¹ç›®æ“ä½œï¼ˆæ–°å»º/æ‰“å¼€/ä¿å­˜ï¼‰çš„æ¥å£å®šä¹‰
  - å…¨å±€é”™è¯¯è¾¹ç•Œç®¡ç†
  - ç”˜ç‰¹å›¾ç»„ä»¶çš„æ‡’åŠ è½½é¢„åŠ è½½

#### æ ¸å¿ƒç”˜ç‰¹å›¾ç»„ä»¶ `src/components/GanttChart.tsx:16`
- **åŠŸèƒ½**: ç”˜ç‰¹å›¾ä¸»ç»„ä»¶
- **çŠ¶æ€ç®¡ç†**: 
  - æ—¥æœŸèŒƒå›´æ§åˆ¶ (dateRangeStart/End)
  - æ—¶é—´é¢—ç²’åº¦æ§åˆ¶ (timeGranularity)
- **ç»„ä»¶ç»„åˆ**: é€šè¿‡ GanttStateManagerã€GanttEventCoordinatorã€GanttContainer å®ç°

#### ç”˜ç‰¹å›¾å­ç³»ç»Ÿæ¶æ„ `src/components/gantt/`

**çŠ¶æ€ç®¡ç†å±‚** `src/components/gantt/GanttStateManager.tsx:1`
- **åŠŸèƒ½**: ç»Ÿä¸€çŠ¶æ€ç®¡ç†ä¸­å¿ƒ
- **é›†æˆHooks**: æ‹–æ‹½ã€ä»»åŠ¡ç®¡ç†ã€æ—¶é—´è½´ã€ç­›é€‰ã€UIçŠ¶æ€ã€äº‹ä»¶å¤„ç†
- **æ•°æ®å¤„ç†**: å¯è§é¡¹ç›®è¡Œè®¡ç®—ã€å¸ƒå±€å¸¸é‡ç®¡ç†

**å®¹å™¨ç»„ä»¶å±‚** `src/components/gantt/GanttContainer.tsx:1`
- **åŠŸèƒ½**: å¸ƒå±€å®¹å™¨å’Œäº‹ä»¶åˆ†å‘
- **ç»„ä»¶ç»„åˆ**: GanttChartHeader + GanttChartBody + GanttMenuManager
- **æ¥å£å®šä¹‰**: ä»»åŠ¡CRUDæ“ä½œã€æ—¥æœŸèŒƒå›´æ§åˆ¶ã€æ‹–æ‹½çŠ¶æ€ç®¡ç†

**æ¸²æŸ“å±‚ç»„ä»¶**:
- `GanttChartHeader`: æ—¶é—´è½´å¤´éƒ¨æ¸²æŸ“
- `GanttChartBody`: ç”˜ç‰¹å›¾ä¸»ä½“æ¸²æŸ“
- `TaskBars`: ä»»åŠ¡æ¡å½¢å›¾æ¸²æŸ“
- `TaskTitleColumn`: ä»»åŠ¡æ ‡é¢˜åˆ—
- `TimelineHeader`: æ—¶é—´çº¿å¤´éƒ¨

### 3. ä¸šåŠ¡é€»è¾‘å±‚ (Hooksç³»ç»Ÿ) `src/hooks/index.ts:1`

#### æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
- **ä»»åŠ¡ç®¡ç†**: `useTaskManager`, `useTaskCRUD`, `useTaskBatch`
- **æ‹–æ‹½äº¤äº’**: `useDragAndDrop`, `useHorizontalDrag`, `useVerticalDrag`
- **æ—¶é—´è½´**: `useTimeline`, `useGanttCalculations`
- **UIçŠ¶æ€**: `useGanttUI`, `useGanttUIState`
- **äº‹ä»¶å¤„ç†**: `useGanttEvents`, `useGanttMouseEvents`, `useGanttKeyboard`

#### é«˜çº§åŠŸèƒ½æ¨¡å—
- **å±‚çº§ç®¡ç†**: `useTaskHierarchy`
- **é€‰æ‹©æœºåˆ¶**: `useTaskSelection`
- **ä¸Šä¸‹æ–‡èœå•**: `useContextMenus`, `useGanttContextMenu`
- **æ ‡ç­¾ç³»ç»Ÿ**: `useGlobalTags`

### 4. æ•°æ®æ¨¡å‹å±‚ `src/types/`

#### æ ¸å¿ƒæ•°æ®ç±»å‹ `src/types/task.ts:9`
```typescript
interface Task {
  // åŸºç¡€ä¿¡æ¯: id, title, description
  // æ—¶é—´ä¿¡æ¯: startDate, endDate
  // çŠ¶æ€ä¿¡æ¯: type, status, progress
  // å±‚çº§å…³ç³»: parentId, children, level
  // æ˜¾ç¤ºå±æ€§: color, tags, order
  // UIçŠ¶æ€: isExpanded
  // è®¡ç®—å±æ€§: x, width (å›¾è¡¨ç»˜åˆ¶)
}
```

#### ç±»å‹ä½“ç³»
- **ä»»åŠ¡ç±»å‹**: `task.ts` - ä»»åŠ¡æ•°æ®æ¨¡å‹
- **é¡¹ç›®ç±»å‹**: `project.ts` - é¡¹ç›®ç»“æ„å®šä¹‰
- **UIçŠ¶æ€**: `ui.ts` - æ‹–æ‹½ã€é€‰æ‹©ã€èœå•çŠ¶æ€
- **æ—¶é—´è½´**: `timeline.ts` - æ—¶é—´é…ç½®å’Œåº¦é‡
- **æ‹–æ‹½**: `drag.ts` - æ‹–æ‹½æ“ä½œçŠ¶æ€

### 5. å·¥å…·å‡½æ•°å±‚
- **ç”˜ç‰¹å›¾å·¥å…·**: `src/utils/ganttUtils.ts` - æ—¥æœŸè®¡ç®—ã€ä½ç½®è½¬æ¢
- **æ˜ å°„å·¥å…·**: `src/utils/taskProjectRowMapping.ts` - ä»»åŠ¡é¡¹ç›®è¡Œæ˜ å°„

### 6. æ ·å¼ç³»ç»Ÿ `src/styles/`
- **æ¨¡å—åŒ–CSS**: æŒ‰ç»„ä»¶å’ŒåŠŸèƒ½åˆ†ç±»
- **å“åº”å¼è®¾è®¡**: `responsive.css`
- **åŠ¨ç”»æ•ˆæœ**: `animations.css`

## æ¶æ„ç‰¹ç‚¹

### ä¼˜åŠ¿
1. **é«˜åº¦æ¨¡å—åŒ–**: åŠŸèƒ½æŒ‰é¢†åŸŸæ¸…æ™°åˆ†ç¦»
2. **Hooké©±åŠ¨**: ä¸šåŠ¡é€»è¾‘å®Œå…¨è§£è€¦
3. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹ä½“ç³»
4. **æ€§èƒ½ä¼˜åŒ–**: æ‡’åŠ è½½ã€èŠ‚æµç­‰ä¼˜åŒ–æªæ–½

### ç»„ä»¶é—´é€šä¿¡æ¨¡å¼
1. **çŠ¶æ€ç®¡ç†**: é€šè¿‡GanttStateManageré›†ä¸­ç®¡ç†
2. **äº‹ä»¶åè°ƒ**: é€šè¿‡GanttEventCoordinatorå¤„ç†
3. **æ•°æ®æµ**: å•å‘æ•°æ®æµï¼Œpropsä¸‹ä¼ ï¼Œäº‹ä»¶ä¸Šå†’æ³¡

### æ ¸å¿ƒåŠŸèƒ½å®ç°
1. **ä»»åŠ¡å±‚çº§**: æ”¯æŒçˆ¶å­å…³ç³»å’Œå±•å¼€/æŠ˜å 
2. **æ‹–æ‹½äº¤äº’**: æ°´å¹³æ—¶é—´è°ƒæ•´å’Œå‚ç›´æ’åº
3. **æ—¶é—´è½´**: å¤šç²’åº¦æ—¶é—´æ˜¾ç¤ºå’Œå¯¼èˆª
4. **è§†è§‰åé¦ˆ**: è¿›åº¦æ¡ã€çŠ¶æ€æŒ‡ç¤ºã€å½“å‰æ—¥æœŸçº¿

## ç»„ä»¶è¯¦ç»†è¯´æ˜

### æ ¸å¿ƒç»„ä»¶æ¨¡å—

#### 1. åº”ç”¨å±‚ç»„ä»¶
- **App.tsx**: åº”ç”¨æ ¹ç»„ä»¶ï¼Œç®¡ç†å…¨å±€çŠ¶æ€å’Œé”™è¯¯è¾¹ç•Œ
- **Header.tsx**: åº”ç”¨å¤´éƒ¨ï¼Œæä¾›é¡¹ç›®æ“ä½œæŒ‰é’®
- **Toolbar.tsx**: å·¥å…·æ ï¼ŒåŒ…å«è§†å›¾æ§åˆ¶å’Œç¼©æ”¾åŠŸèƒ½

#### 2. ç”˜ç‰¹å›¾æ ¸å¿ƒç»„ä»¶
- **GanttChart.tsx**: ä¸»ç”˜ç‰¹å›¾ç»„ä»¶ï¼Œç®¡ç†æ—¥æœŸèŒƒå›´å’Œæ—¶é—´é¢—ç²’åº¦
- **GanttChartLazy.tsx**: æ‡’åŠ è½½åŒ…è£…å™¨ï¼Œä¼˜åŒ–é¦–å±åŠ è½½æ€§èƒ½
- **LazyWrapper.tsx**: é€šç”¨æ‡’åŠ è½½ç»„ä»¶

#### 3. ç”˜ç‰¹å›¾å­ç³»ç»Ÿç»„ä»¶
- **GanttStateManager.tsx**: çŠ¶æ€ç®¡ç†ä¸­å¿ƒï¼Œé›†æˆæ‰€æœ‰ä¸šåŠ¡é€»è¾‘Hooks
- **GanttEventCoordinator.tsx**: äº‹ä»¶åè°ƒå™¨ï¼Œå¤„ç†ç»„ä»¶é—´äº‹ä»¶é€šä¿¡
- **GanttContainer.tsx**: å¸ƒå±€å®¹å™¨ï¼Œç»„åˆå¤´éƒ¨å’Œä¸»ä½“ç»„ä»¶
- **GanttDataProvider.tsx**: æ•°æ®æä¾›è€…ï¼Œç®¡ç†æ•°æ®ä¸Šä¸‹æ–‡
- **GanttEventHandler.tsx**: äº‹ä»¶å¤„ç†å™¨ï¼Œç»Ÿä¸€äº‹ä»¶å¤„ç†é€»è¾‘

#### 4. æ¸²æŸ“å±‚ç»„ä»¶
- **GanttChartHeader.tsx**: ç”˜ç‰¹å›¾å¤´éƒ¨æ¸²æŸ“
- **GanttChartBody.tsx**: ç”˜ç‰¹å›¾ä¸»ä½“æ¸²æŸ“
- **TimelineHeader.tsx**: æ—¶é—´çº¿å¤´éƒ¨ç»„ä»¶
- **TaskBars.tsx**: ä»»åŠ¡æ¡å½¢å›¾æ¸²æŸ“ç»„ä»¶
- **TaskTitleColumn.tsx**: ä»»åŠ¡æ ‡é¢˜åˆ—ç»„ä»¶

#### 5. äº¤äº’ç»„ä»¶
- **TaskIcon.tsx**: ä»»åŠ¡å›¾æ ‡å’Œæ‹–æ‹½æ‰‹æŸ„
- **TaskIconSelector.tsx**: ä»»åŠ¡å›¾æ ‡é€‰æ‹©å™¨
- **ColorPicker.tsx**: é¢œè‰²é€‰æ‹©å™¨
- **DateRangePicker.tsx**: æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨
- **TimeGranularitySelector.tsx**: æ—¶é—´é¢—ç²’åº¦é€‰æ‹©å™¨

#### 6. èœå•å’Œç®¡ç†ç»„ä»¶
- **GanttContextMenu.tsx**: ç”˜ç‰¹å›¾ä¸Šä¸‹æ–‡èœå•
- **TaskContextMenu.tsx**: ä»»åŠ¡ä¸Šä¸‹æ–‡èœå•ï¼ˆç”˜ç‰¹å›¾åŒºåŸŸï¼‰
- **TaskTitleContextMenu.tsx**: ä»»åŠ¡æ ‡é¢˜å³é”®èœå•ï¼ˆæ–°å¢ 2025-07-20ï¼‰
- **GanttMenuManager.tsx**: èœå•ç®¡ç†å™¨
- **TagManager.tsx**: æ ‡ç­¾ç®¡ç†å™¨

#### 7. å±‚çº§æ§åˆ¶ç»„ä»¶
- **TaskHierarchyControls.tsx**: ä»»åŠ¡å±‚çº§æ§åˆ¶ç»„ä»¶
- **TaskTitleItem.tsx**: ä»»åŠ¡æ ‡é¢˜é¡¹ç»„ä»¶

#### 8. å·¥å…·ç»„ä»¶
- **ErrorBoundary.tsx**: é”™è¯¯è¾¹ç•Œç»„ä»¶
- **icons/index.ts**: å›¾æ ‡ç»„ä»¶é›†åˆ

### Hookç³»ç»Ÿè¯¦ç»†è¯´æ˜

#### 1. æ ¸å¿ƒçŠ¶æ€ç®¡ç†Hooks
- **useGanttState.tsx**: ç”˜ç‰¹å›¾ä¸»çŠ¶æ€ç®¡ç†
- **useGanttUIState.tsx**: UIçŠ¶æ€ç®¡ç†
- **useTaskManager.tsx**: ä»»åŠ¡ç®¡ç†æ ¸å¿ƒé€»è¾‘

#### 2. ä»»åŠ¡æ“ä½œHooks
- **useTaskCRUD.tsx**: ä»»åŠ¡å¢åˆ æ”¹æŸ¥æ“ä½œ
- **useTaskBatch.tsx**: æ‰¹é‡ä»»åŠ¡æ“ä½œ
- **useTaskEditor.tsx**: ä»»åŠ¡ç¼–è¾‘åŠŸèƒ½
- **useTaskHierarchy.tsx**: ä»»åŠ¡å±‚çº§ç®¡ç†
- **useTaskAttributes.tsx**: ä»»åŠ¡å±æ€§ç®¡ç†
- **useTaskSelection.tsx**: ä»»åŠ¡é€‰æ‹©æœºåˆ¶
- **useTaskFilter.tsx**: ä»»åŠ¡ç­›é€‰åŠŸèƒ½

#### 3. æ‹–æ‹½ç³»ç»ŸHooks
- **useDragAndDrop.tsx**: æ‹–æ‹½ä¸»é€»è¾‘
- **useDragReducer.tsx**: æ‹–æ‹½çŠ¶æ€ç®¡ç†
- **useHorizontalDrag.tsx**: æ°´å¹³æ‹–æ‹½ï¼ˆæ—¶é—´è°ƒæ•´ï¼‰
- **useVerticalDrag.tsx**: å‚ç›´æ‹–æ‹½ï¼ˆæ’åºï¼‰
- **useThrottledMouseMove.tsx**: èŠ‚æµé¼ æ ‡ç§»åŠ¨äº‹ä»¶

#### 4. äº‹ä»¶å¤„ç†Hooks
- **useGanttEvents.tsx**: ç”˜ç‰¹å›¾äº‹ä»¶å¤„ç†
- **useGanttMouseEvents.tsx**: é¼ æ ‡äº‹ä»¶å¤„ç†
- **useGanttKeyboard.tsx**: é”®ç›˜äº‹ä»¶å¤„ç†
- **useGanttInteractions.tsx**: äº¤äº’é€»è¾‘ç®¡ç†
- **useGanttHandlers.tsx**: äº‹ä»¶å¤„ç†å™¨é›†åˆ

#### 5. UIæ§åˆ¶Hooks
- **useGanttUI.tsx**: UIæ§åˆ¶é€»è¾‘
- **useGanttCalculations.tsx**: ç”˜ç‰¹å›¾è®¡ç®—é€»è¾‘
- **useTimeline.tsx**: æ—¶é—´è½´ç®¡ç†
- **useTitleColumnResize.tsx**: æ ‡é¢˜åˆ—è°ƒæ•´å¤§å°

#### 6. èœå•ç³»ç»ŸHooks
- **useContextMenus.tsx**: ä¸Šä¸‹æ–‡èœå•ç®¡ç†
- **useGanttContextMenu.tsx**: ç”˜ç‰¹å›¾ä¸Šä¸‹æ–‡èœå•

#### 7. å…¨å±€åŠŸèƒ½Hooks
- **useGlobalTags.tsx**: å…¨å±€æ ‡ç­¾ç³»ç»Ÿ
- **useErrorHandler.tsx**: é”™è¯¯å¤„ç†
- **useThrottle.tsx**: èŠ‚æµå·¥å…·
- **useCache.tsx**: ç¼“å­˜å·¥å…·

### ç±»å‹ç³»ç»Ÿè¯´æ˜

#### 1. æ ¸å¿ƒæ•°æ®ç±»å‹
- **task.ts**: ä»»åŠ¡æ•°æ®æ¨¡å‹ï¼ŒåŒ…å«å®Œæ•´çš„ä»»åŠ¡ä¿¡æ¯ç»“æ„
- **project.ts**: é¡¹ç›®ç›¸å…³ç±»å‹å®šä¹‰
- **common.ts**: é€šç”¨ç±»å‹å®šä¹‰ï¼ˆTaskTypeã€TaskStatusç­‰ï¼‰

#### 2. UIçŠ¶æ€ç±»å‹
- **ui.ts**: UIçŠ¶æ€ç±»å‹ï¼ˆæ‹–æ‹½ã€é€‰æ‹©ã€èœå•çŠ¶æ€ï¼‰
- **drag.ts**: æ‹–æ‹½æ“ä½œç›¸å…³ç±»å‹
- **timeline.ts**: æ—¶é—´è½´é…ç½®å’Œåº¦é‡ç±»å‹

#### 3. ç”˜ç‰¹å›¾ç±»å‹
- **gantt.ts**: ç”˜ç‰¹å›¾ç‰¹å®šç±»å‹å®šä¹‰

### å·¥å…·å‡½æ•°è¯´æ˜

#### 1. ç”˜ç‰¹å›¾å·¥å…·å‡½æ•° `src/utils/ganttUtils.ts`
- æ—¥æœŸè®¡ç®—å’Œè½¬æ¢
- åƒç´ ä½ç½®è®¡ç®—
- ä»»åŠ¡å®šä½ç®—æ³•

#### 2. ä»»åŠ¡æ˜ å°„å·¥å…· `src/utils/taskProjectRowMapping.ts`
- ä»»åŠ¡ä¸é¡¹ç›®è¡Œçš„æ˜ å°„å…³ç³»
- å±‚çº§ç»“æ„å¤„ç†

### æ ·å¼ç³»ç»Ÿè¯´æ˜

#### 1. åŸºç¡€æ ·å¼
- **base.css**: åŸºç¡€æ ·å¼å®šä¹‰
- **index.css**: å…¨å±€æ ·å¼å…¥å£
- **layout.css**: å¸ƒå±€ç›¸å…³æ ·å¼
- **responsive.css**: å“åº”å¼è®¾è®¡
- **animations.css**: åŠ¨ç”»æ•ˆæœ

#### 2. ç»„ä»¶æ ·å¼
- **buttons.css**: æŒ‰é’®æ ·å¼
- **gantt.css**: ç”˜ç‰¹å›¾ä¸»è¦æ ·å¼
- **tasks.css**: ä»»åŠ¡ç›¸å…³æ ·å¼
- **toolbar.css**: å·¥å…·æ æ ·å¼
- **milestones.css**: é‡Œç¨‹ç¢‘æ ·å¼

## å¼€å‘æŒ‡å¯¼åŸåˆ™

### ä»£ç ç»„ç»‡åŸåˆ™
1. **å•ä¸€èŒè´£**: æ¯ä¸ªæ–‡ä»¶å’Œç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸ
2. **æ¨¡å—åŒ–**: é€šè¿‡æ¸…æ™°çš„å¯¼å…¥å¯¼å‡ºç®¡ç†ä¾èµ–å…³ç³»
3. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
4. **æ€§èƒ½ä¼˜åŒ–**: æ‡’åŠ è½½ã€è®°å¿†åŒ–ã€äº‹ä»¶èŠ‚æµç­‰æŠ€æœ¯

### æ¶æ„ä¼˜åŠ¿
1. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„åˆ†å±‚å’Œæ¨¡å—åŒ–è®¾è®¡
2. **å¯æ‰©å±•æ€§**: Hookç³»ç»Ÿæ”¯æŒåŠŸèƒ½çš„çµæ´»ç»„åˆ
3. **å¯æµ‹è¯•æ€§**: ä¸šåŠ¡é€»è¾‘ä¸UIåˆ†ç¦»ï¼Œä¾¿äºå•å…ƒæµ‹è¯•
4. **å¼€å‘ä½“éªŒ**: å®Œæ•´çš„ç±»å‹æç¤ºå’Œé”™è¯¯å¤„ç†

## ğŸ“‹ æœ€æ–°åŠŸèƒ½æ‰©å±•ï¼šä»»åŠ¡æ ‡é¢˜å³é”®èœå•ç³»ç»Ÿ

### åŠŸèƒ½æ¦‚è¿°ï¼ˆ2025-07-20 æ–°å¢ï¼‰

ä¸ºä»»åŠ¡æ ‡é¢˜åˆ—æ·»åŠ äº†ç‹¬ç«‹çš„å³é”®èœå•ç³»ç»Ÿï¼Œæä¾›ä»»åŠ¡åç§°ç¼–è¾‘å’Œå›¾æ ‡é€‰æ‹©åŠŸèƒ½ï¼Œä¸ç”˜ç‰¹å›¾åŒºåŸŸçš„ä»»åŠ¡èœå•å®Œå…¨åˆ†ç¦»ã€‚

### æ¶æ„è®¾è®¡

#### 1. ç»„ä»¶æ¶æ„
```
TaskTitleItem.tsx (å·²æ‰©å±•)
â”œâ”€â”€ çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ ç¼–è¾‘çŠ¶æ€ (isEditing)
â”‚   â”œâ”€â”€ èœå•çŠ¶æ€ (contextMenu)
â”‚   â””â”€â”€ ç¼–è¾‘å€¼ (editValue)
â”œâ”€â”€ äº‹ä»¶å¤„ç†
â”‚   â”œâ”€â”€ å³é”®èœå•è§¦å‘ (handleContextMenu)
â”‚   â”œâ”€â”€ å†…è”ç¼–è¾‘æ§åˆ¶ (handleStartNameEdit, handleConfirmEdit)
â”‚   â””â”€â”€ å›¾æ ‡é€‰æ‹© (handleIconChange)
â””â”€â”€ UI æ¸²æŸ“
    â”œâ”€â”€ å†…è”ç¼–è¾‘è¾“å…¥æ¡†
    â””â”€â”€ TaskTitleContextMenu ç»„ä»¶

TaskTitleContextMenu.tsx (æ–°å¢)
â”œâ”€â”€ ä¸»èœå•
â”‚   â”œâ”€â”€ æ›´æ”¹ä»»åŠ¡åç§°
â”‚   â””â”€â”€ æ›´æ”¹ä»»åŠ¡å›¾æ ‡ (æ‚¬åœå±•å¼€)
â””â”€â”€ äºŒçº§èœå•
    â””â”€â”€ å›¾æ ‡é€‰æ‹©å™¨ (5ç§å›¾æ ‡ç±»å‹)
```

#### 2. æ•°æ®æµè®¾è®¡
```
ç”¨æˆ·äº¤äº’ â†’ TaskTitleItem â†’ handleTaskUpdate â†’ æ•°æ®æµä¼ é€’

æ•°æ®æµä¼ é€’è·¯å¾„ï¼š
GanttStateManager.handleTaskUpdate
    â†“
GanttEventCoordinator.handleTaskUpdate
    â†“
GanttContainer.onTaskUpdate
    â†“
GanttChartBody.onTaskUpdate
    â†“
TaskTitleColumn.onTaskUpdate
    â†“
TaskTitleItem.onTaskUpdate
    â†“
setTasks çŠ¶æ€æ›´æ–°
```

#### 3. æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

**3.1 ä»»åŠ¡åç§°å†…è”ç¼–è¾‘**
- è§¦å‘ï¼šç‚¹å‡»"æ›´æ”¹ä»»åŠ¡åç§°"èœå•é¡¹
- ç¼–è¾‘æ¨¡å¼ï¼šåŸä½ç½®è¾“å…¥æ¡†æ›¿æ¢æ–‡æœ¬
- äº¤äº’ï¼šEnterç¡®è®¤ã€Escapeå–æ¶ˆã€ç‚¹å‡»å¤–éƒ¨ç¡®è®¤
- æ•°æ®æ›´æ–°ï¼šé€šè¿‡ `handleTaskUpdate` ç›´æ¥æ›´æ–°ä»»åŠ¡ title å­—æ®µ

**3.2 ä»»åŠ¡å›¾æ ‡é€‰æ‹©**
- è§¦å‘ï¼šæ‚¬åœ"æ›´æ”¹ä»»åŠ¡å›¾æ ‡"èœå•é¡¹
- æ˜¾ç¤ºï¼šäºŒçº§èœå•åœ¨ä¸»èœå•å³ä¾§å±•å¼€
- é€‰é¡¹ï¼šdefault, milestone, development, testing, delivery
- æ•°æ®æ›´æ–°ï¼šé€šè¿‡ `handleTaskUpdate` ç›´æ¥æ›´æ–°ä»»åŠ¡ type å­—æ®µ

**3.3 èœå•ç³»ç»Ÿç‹¬ç«‹æ€§**
- **ä»»åŠ¡æ ‡é¢˜èœå•**ï¼šä¸“æ³¨äºä»»åŠ¡åŸºæœ¬ä¿¡æ¯ç¼–è¾‘ï¼ˆåç§°+å›¾æ ‡ï¼‰
- **ç”˜ç‰¹å›¾ä»»åŠ¡èœå•**ï¼šä¸“æ³¨äºä»»åŠ¡å±æ€§ç®¡ç†ï¼ˆé¢œè‰²+æ ‡ç­¾+åˆ é™¤ï¼‰
- å®Œå…¨ç‹¬ç«‹çš„ç»„ä»¶å’Œäº‹ä»¶å¤„ç†ï¼Œæ— äº¤å‰ä¾èµ–

#### 4. æŠ€æœ¯å®ç°è¦ç‚¹

**4.1 çŠ¶æ€ç®¡ç†**
```typescript
// TaskTitleItem.tsx ä¸­çš„å…³é”®çŠ¶æ€
const [isEditing, setIsEditing] = useState(false);
const [editValue, setEditValue] = useState(task.title);
const [contextMenu, setContextMenu] = useState({
  visible: false,
  x: 0,
  y: 0
});
```

**4.2 ä»»åŠ¡æ›´æ–°å‡½æ•°**
```typescript
// GanttStateManager.tsx ä¸­çš„æ ¸å¿ƒå‡½æ•°
const handleTaskUpdate = useCallback((taskId: string, updates: Partial<Task>) => {
  setTasks(prevTasks => 
    prevTasks.map(task => 
      task.id === taskId 
        ? { ...task, ...updates }
        : task
    )
  );
}, [setTasks]);
```

**4.3 èœå•å®šä½ç®—æ³•**
```typescript
// å³é”®èœå•ä½ç½®è®¡ç®—
setContextMenu({
  visible: true,
  x: e.clientX,  // é¼ æ ‡ç›¸å¯¹è§†å£çš„Xåæ ‡
  y: e.clientY   // é¼ æ ‡ç›¸å¯¹è§†å£çš„Yåæ ‡
});

// äºŒçº§èœå•ä½ç½®è®¡ç®—
const submenuStyle = {
  left: x + 160,  // ä¸»èœå•å®½åº¦ + é—´è·
  top: y
};
```

#### 5. æ‰©å±•å½±å“åˆ†æ

**5.1 æ–°å¢æ–‡ä»¶**
- `src/components/gantt/TaskTitleContextMenu.tsx` - ç‹¬ç«‹å³é”®èœå•ç»„ä»¶

**5.2 ä¿®æ”¹æ–‡ä»¶åŠå½±å“**
- `TaskTitleItem.tsx` - é›†æˆèœå•åŠŸèƒ½ï¼Œæ·»åŠ å†…è”ç¼–è¾‘
- `TaskTitleColumn.tsx` - æ·»åŠ  onTaskUpdate props ä¼ é€’
- `GanttChartBody.tsx` - ä¼ é€’ä»»åŠ¡æ›´æ–°å‡½æ•°
- `GanttContainer.tsx` - æ•°æ®æµä¼ é€’
- `GanttEventCoordinator.tsx` - äº‹ä»¶åè°ƒæ‰©å±•
- `GanttStateManager.tsx` - æ·»åŠ ä»»åŠ¡æ›´æ–°æ ¸å¿ƒé€»è¾‘
- `GanttChart.tsx` - é¡¶å±‚æ•°æ®æµé›†æˆ

**5.3 æ¶æ„å…¼å®¹æ€§**
- âœ… å®Œå…¨å…¼å®¹ç°æœ‰æ¶æ„æ¨¡å¼
- âœ… æ— ç ´åæ€§å˜æ›´
- âœ… éµå¾ªç°æœ‰çš„æ•°æ®æµè®¾è®¡
- âœ… ä¿æŒç»„ä»¶èŒè´£å•ä¸€åŸåˆ™

#### 6. æ€§èƒ½è€ƒè™‘

**6.1 ä¼˜åŒ–ç­–ç•¥**
- ä½¿ç”¨ `useCallback` ä¼˜åŒ–äº‹ä»¶å¤„ç†å‡½æ•°
- èœå•ç»„ä»¶æŒ‰éœ€æ¸²æŸ“ï¼ˆvisible æ§åˆ¶ï¼‰
- å†…è”ç¼–è¾‘ä½¿ç”¨ ref ç›´æ¥æ“ä½œ DOM

**6.2 å†…å­˜ç®¡ç†**
- æ­£ç¡®çš„äº‹ä»¶ç›‘å¬å™¨æ¸…ç†
- ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ¸…ç†çŠ¶æ€
- é¿å…å†…å­˜æ³„æ¼çš„å®šæ—¶å™¨å¤„ç†

#### 7. è°ƒè¯•å’Œç»´æŠ¤

**7.1 è°ƒè¯•å·¥å…·**
- React DevTools æŸ¥çœ‹çŠ¶æ€å˜åŒ–
- æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥äº‹ä»¶ç»‘å®š
- TypeScript ç¼–è¯‘æ£€æŸ¥ç±»å‹å®‰å…¨

**7.2 å¸¸è§é—®é¢˜**
- èœå•å®šä½é—®é¢˜ï¼šæ£€æŸ¥åæ ‡è®¡ç®—
- ç¼–è¾‘çŠ¶æ€å¼‚å¸¸ï¼šéªŒè¯ ref èšç„¦
- æ•°æ®ä¸æ›´æ–°ï¼šç¡®è®¤å‡½æ•°ä¼ é€’é“¾

---

*æœ¬æ–‡æ¡£è®°å½•äº†Ganttoç”˜ç‰¹å›¾åº”ç”¨çš„å®Œæ•´ä»£ç æ¶æ„ï¼ŒåŒ…æ‹¬2025-07-20æ–°å¢çš„ä»»åŠ¡æ ‡é¢˜å³é”®èœå•åŠŸèƒ½çš„è¯¦ç»†æŠ€æœ¯å®ç°ã€‚*